{
  "hash": "ba7d062266ff23dbd47a366cd5540cd6",
  "result": {
    "markdown": "---\ntitle: \"Geospatial Blog Post\"\ndescription: \"Creating a Function for Coastal Species Habitat\"\nauthor:\n  - name: Erica Dale\n    url: http://ericamarie9016.githubt.io\n    affiliation: MEDS\n    affiliation-url: http://ucsb-meds.github.io\ndate: 2022-12-02\nformat:\n  html:\n    code-fold: true\n    code-summary: \"Show the code\"\ncode-overflow: wrap\ncode-block-bg: true\ncode-block-border-left: \"#6B5A75\"\ncategories: [MEDS, Geospatial, R, West Coast, Oysters]\ncitation: \n  url: http://ericamarie9016.github.io/2022-12-02-geospatial\n#bibliography: references.bib\n# image: \n# draft: TRUE\n---\n\n\n### Introduction\n\nThis project explores the suitable habitats for species along the Western Coast, beginning with an Oyster and then creating a function to explore any species. The parameters to explore are depth and sea surface temperature. This could futher be expanded with more variables, including change of temperature within the water column. These regions are broken down to five Exclusive Economic Zones (EEZ) along the West Coast of the US.\n\nThis could be applied for restoration efforts to determine where habitat is suitable for any oceanic species.\\\n\n### Data\n\n-   Average annual sea surface temperature (SST) from the years 2008 to 2012: [NOAA's 5km Daily Global Satellite Sea Surface Temperature Anomaly v3.1](https://coralreefwatch.noaa.gov/product/5km/index_5km_ssta.php).\n\n-   Depth of the ocean: [General Bathymetric Chart of the Oceans (GEBCO)](https://www.gebco.net/data_and_products/gridded_bathymetry_data/#area).[^1]\n\n-   Exclusive Economic Zones off of the west coast of US: [Marineregions.org](https://www.marineregions.org/eez.php).\n\n[^1]: GEBCO Compilation Group (2022) GEBCO_2022 Grid (<doi:10.5285/e0f0bb80-ab44-2739-e053-6c86abc0289c>).\n\n\n::: {.cell messages='false'}\n\n```{.r .cell-code}\nlibrary(terra)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nterra 1.6.41\n```\n:::\n\n```{.r .cell-code}\nlibrary(here)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nhere() starts at C:/Users/Bearica/Documents/MEDS/ericamarie9016.github.io\n```\n:::\n\n```{.r .cell-code}\nlibrary(sf)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLinking to GEOS 3.10.2, GDAL 3.4.1, PROJ 7.2.1; sf_use_s2() is TRUE\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n-- Attaching packages --------------------------------------- tidyverse 1.3.2 --\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nv ggplot2 3.4.0      v purrr   0.3.5 \nv tibble  3.1.8      v dplyr   1.0.10\nv tidyr   1.2.1      v stringr 1.4.1 \nv readr   2.1.3      v forcats 0.5.2 \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx tidyr::extract() masks terra::extract()\nx dplyr::filter()  masks stats::filter()\nx dplyr::lag()     masks stats::lag()\n```\n:::\n\n```{.r .cell-code}\nlibrary(tmap)\nlibrary(ggpubr)    # Combines ggplots\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n\nAttaching package: 'ggpubr'\n\nThe following object is masked from 'package:terra':\n\n    rotate\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nRegions <- read_sf(\"~/MEDS/Fall-EDS223-Geospatial/data/data_4/wc_regions_clean.shp\")\nst_crs(Regions)       # WGS84 EPSG 4326\n\nAnnual2008 <- rast(\"~/MEDS/Fall-EDS223-Geospatial/data/data_4/average_annual_sst_2008.tif\")\nAnnual2009 <- rast(\"~/MEDS/Fall-EDS223-Geospatial/data/data_4/average_annual_sst_2009.tif\")\nAnnual2010 <- rast(\"~/MEDS/Fall-EDS223-Geospatial/data/data_4/average_annual_sst_2010.tif\")\nAnnual2011 <- rast(\"~/MEDS/Fall-EDS223-Geospatial/data/data_4/average_annual_sst_2011.tif\")\nAnnual2012 <- rast(\"~/MEDS/Fall-EDS223-Geospatial/data/data_4/average_annual_sst_2012.tif\")\nSSTAnnual <- c(Annual2008, Annual2009, Annual2010, Annual2011, Annual2012)     # stack the annual\nst_crs(SSTAnnual)    # WGS84, EPSG 9122\n\nDepth <- rast(\"~/MEDS/Fall-EDS223-Geospatial/data/data_4/depth.tif\")\nst_crs(Depth)        # WGS84, EPSG 4326\n\n\n\n#### Reproject ###\n\nSSTAnnual <- project(SSTAnnual, Depth)\nst_crs(SSTAnnual)     # WGS84, EPSG 4326\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n### Find mean SST ###\n\n# Collapse down layers to one SST mean\nSSTMean <- mean(SSTAnnual)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n|---------|---------|---------|---------|\n=========================================\n                                          \n```\n:::\n\n```{.r .cell-code}\nSSTMean <- (SSTMean$mean - 273.15)\nplot(SSTMean)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#Check they will match\nSSTDepth <- c(Depth, SSTMean)\n```\n:::\n\n\n### Find suitable locations\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# sea surface temperature: 11-30Â°C = 284.15 - 303.15\n# depth: 0-70 meters below sea level\n\n### Set up reclassification matrices ###\nSSTrcl <- matrix(c(-Inf, 11, NA,\n                   11, 30, 1,   \n                   30, Inf, NA),\n                     ncol = 3, byrow = TRUE)\nOysterSST <- classify(SSTMean, rcl = SSTrcl)\nplot(OysterSST, col = \"blue\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n\n```{.r .cell-code}\nDepthrcl <- matrix(c(-Inf, -70, NA,\n                     -70, 0, 1,\n                     0, Inf, NA),\n                     ncol = 3, byrow = TRUE)\nOysterDepth <- classify(Depth, rcl = Depthrcl)\nplot(OysterDepth, col = \"blue\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-2.png){width=672}\n:::\n\n```{.r .cell-code}\n### Overlay # Find areas that satisfy BOTH\n\nfun_mult = function(x,y){return(x*y)}     # Function to multiply layers\n\nOystersHabitat <- lapp(c(OysterSST, OysterDepth), fun_mult)\nplot(OystersHabitat, col = \"blue\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-3.png){width=672}\n:::\n:::\n\n\n### Determine the most suitable EEZ\n\n\n::: {.cell}\n\n```{.r .cell-code}\n##### Turn Regions data into raster\nRegions$rgn <- as.factor(Regions$rgn)\nRegionsRast <- rasterize(vect(Regions), OystersHabitat, field = \"rgn\")\nplot(RegionsRast)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n##### Select suitable cells in EEZ\nROmask <- mask(RegionsRast, OystersHabitat)\n\n\n##### Find area of grid cells\nexpanse(ROmask, unit = \"km\")          # 11099.3 km\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 11099.3\n```\n:::\n\n```{.r .cell-code}\n##### Find total suitable area within each EEZ\nOysterZone <- expanse(ROmask, unit = \"km\", byValue = TRUE)\nOysterZone\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     layer value      area\n[1,]     1     0 3864.5258\n[2,]     1     1  150.4956\n[3,]     1     2 1089.7404\n[4,]     1     3 3467.7569\n[5,]     1     4 2526.7837\n```\n:::\n\n```{.r .cell-code}\n##### Find percentage of each zone\nOysterRegion <- cbind(OysterZone, Regions)\nOysterRegion <- OysterRegion |> \n  mutate(percent = (area/area_km2)*100)\n\n\nprint(paste(\"Central California has 3864.5258 km2,  2.14% of the EEZ. Northern California has 150.4956 km2, .09% of the EEZ. Orgeon has 1089.7404 km2, with .53%. Southern California has 3467.7569 km2, with 1.67%. Washington has 2526.7837 with 3.77%\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Central California has 3864.5258 km2,  2.14% of the EEZ. Northern California has 150.4956 km2, .09% of the EEZ. Orgeon has 1089.7404 km2, with .53%. Southern California has 3467.7569 km2, with 1.67%. Washington has 2526.7837 with 3.77%\"\n```\n:::\n:::\n\n\n### Visualization\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#### Total suitable area by region\ntm_shape(OysterRegion) +\n  tm_polygons(\"area\", palette = \"YlGn\") +\n  tm_text(text = \"rgn\",\n          size = .7) +\n  tm_layout(main.title = \"Suitable Oyster Area\",\n            main.title.size = 1.2,\n            main.title.position = \"center\") +\n  tm_layout(legend.position = c(\"left\", \"bottom\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nSome legend labels were too wide. These labels have been resized to 0.55, 0.55, 0.55. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n#### Percent suitable area by region\ntm_shape(OysterRegion) +\n  tm_polygons(\"percent\", palette = \"YlGn\") +\n  tm_text(text = \"rgn\",\n          size = .7) +\n  tm_layout(main.title = \"Suitable Oyster Percentage\",\n            main.title.size = 1.2,\n            main.title.position = \"center\") +\n  tm_layout(legend.position = c(\"left\", \"bottom\"))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\n### Creating a Function\n\n\n::: {.cell}\n\n```{.r .cell-code}\nSpecies_Habitat <- function(species_name, temp_min, temp_max, depth_max, depth_min){\n  \n  # RECLASSIFICATION #\n  SSTrcl <- matrix(c(-Inf, temp_min, NA,\n                   temp_min, temp_max, 1,\n                   temp_max, Inf, NA),\n                   ncol = 3, byrow = TRUE)\n  Depthrcl <- matrix(c(-Inf, depth_max, NA,\n                     depth_max, depth_min, 1,\n                     depth_min, Inf, NA),\n                     ncol = 3, byrow = TRUE)  \n  \n  # APPLY RECLASS TO BOTH #\n  SpeciesSST <- classify(SSTMean, rcl = SSTrcl)\n  SpeciesDepth <- classify(Depth, rcl = Depthrcl)\n  SpeciesHabitat <- lapp(c(SpeciesSST, SpeciesDepth), fun_mult)\n  \n  # # EEZ #\n  # ##### Select suitable cells in EEZ\n  Regions$rgn <- as.factor(Regions$rgn)\n  RegionsSpecRast <- rasterize(vect(Regions), SpeciesHabitat, field = \"rgn\")\n  RSpecmask <- mask(RegionsSpecRast, SpeciesHabitat)\n  # Checked to work to here\n\n  # ##### Find total suitable area within each EEZ\n  SpeciesZone <- expanse(RSpecmask, unit = \"km\", byValue = TRUE)\n  SpeciesZone # Error on row number matching???\n\n  # ##### Find percentage of each zone\n  SpeciesRegion <- cbind(SpeciesZone, Regions)\n  SpeciesRegion <- SpeciesRegion |>\n     mutate(percent = (area/area_km2)*100)\n  \n  # Total suitable area by region\n  SpecAreaMap <- tm_shape(SpeciesRegion) +\n  tm_polygons(\"area\", palette = \"YlGn\") +\n  tm_text(text = \"rgn\",\n          size = .7) +\n  tm_layout(main.title = print(paste0(species_name,  \" Suitable Area\")),\n            main.title.size = 1.2,\n            main.title.position = \"center\") +\n  tm_layout(legend.position = c(\"left\", \"bottom\"))\n\n  # Percent suitable area by region\n  SpecPercMap <- tm_shape(SpeciesRegion) +\n  tm_polygons(\"percent\", palette = \"YlGn\") +\n  tm_text(text = \"rgn\",\n          size = .7) +\n  tm_layout(main.title = print(paste0(species_name, \" Suitable Percentage\")),\n            main.title.size = 1.2,\n            main.title.position = \"center\") +\n  tm_layout(legend.position = c(\"left\", \"bottom\"))\n  \n  tmap_arrange(SpecAreaMap, SpecPercMap)\n  \n}\n\n\nSpecies_Habitat(\"Dolphin\", 11, 30, -70, 0)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Dolphin Suitable Area\"\n[1] \"Dolphin Suitable Percentage\"\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}